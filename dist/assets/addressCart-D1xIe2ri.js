import{R as H,r as c,p as U,a as q,j as e,S as g,L as y,f as $,w as z,s as d,x as R,y as W,z as G,A as J}from"./index-JgG0EqwT.js";function Y({setAddDetail:f}){const i=JSON.parse(sessionStorage.getItem("userLocation")),[_,j]=c.useState(!1),[u,h]=c.useState("Home"),[v,N]=c.useState(!1),[l,w]=c.useState({}),[a,b]=c.useState({}),{register:S,handleSubmit:k,reset:A,setValue:L,formState:{errors:p}}=U({mode:"onChange"});c.useEffect(()=>{l?.address_line1?(L("address_line2",l?.address_line2),h(l?.type),b(l)):A()},[l]);const{data:C,isLoading:D,refetch:x}=q({queryKey:["addressList"],queryFn:async()=>J({page:1,pageSize:1e3})}),m=C?.results?.addresses;c.useEffect(()=>{if(m&&m?.length>0){const s=m.find(t=>t.isDefault===!0);s&&f(s)}},[m]);const O=async s=>{N(!0);const t={address_line1:i?.fullAddress,address_line2:s.address_line2,postal_code:i?.postcode,city:i?.city,country:i?.country,latitude:i?.coordinates?.lat,longitude:i?.coordinates?.lng,type:u},r={addressId:l?._id,address_line1:a?.address_line1?a?.address_line1:a?.fullAddress,address_line2:s.address_line2,postal_code:a?.postal_code?a?.postal_code:a?.postcode,city:a?.city,country:a?.country,latitude:a?.coordinates?a?.coordinates?.lat:a?.latitude,longitude:a?.coordinates?a?.coordinates?.lng:a?.longitude,type:u};try{const o=l?.address_line1?await W(r):await G(t);o.error?d(o.message,"error"):(d(o.message,"success"),await x(),document.getElementById("closeAddressModal").click())}catch{console.log("An error occurred")}finally{N(!1)}},E=()=>new Promise((s,t)=>{if(!navigator.geolocation){t(new Error("GEOLOCATION_NOT_SUPPORTED"));return}navigator.geolocation.getCurrentPosition(r=>s(r.coords),r=>t(r),{enableHighAccuracy:!0,timeout:15e3,maximumAge:0})}),P=async(s,t)=>{try{const r=await fetch(`https://nominatim.openstreetmap.org/reverse?format=json&lat=${s}&lon=${t}&addressdetails=1`,{headers:{"User-Agent":"YourAppName/1.0"}});if(!r.ok)throw new Error("Failed to fetch address");const o=await r.json(),n=o.address||{};return{fullAddress:o.display_name||"Address not found",locality:n.suburb||n.neighbourhood||n.village||"",city:n.city||n.town||n.state_district||"",state:n.state||"",country:n.country||"",postcode:n.postcode||"",formattedShort:F(n),coordinates:{lat:s,lng:t}}}catch(r){throw console.error("Address fetch error:",r),r}},F=s=>{const t=[];return(s.suburb||s.neighbourhood)&&t.push(s.suburb||s.neighbourhood),s.city||s.town?t.push(s.city||s.town):s.state_district&&t.push(s.state_district),t.join(", ")||"Current Location"},T=async()=>{j(!0);try{const s=await E(),{latitude:t,longitude:r}=s,o=await P(t,r);return l?.address_line1?b(o):sessionStorage.setItem("userLocation",JSON.stringify(o)),o}catch(s){return console.error("âŒ Location error:",s),s.message==="GEOLOCATION_NOT_SUPPORTED"?d("Your browser doesn't support location services","error"):s.code===1?d("Location access denied. Please enable location permission in your browser settings.","error"):s.code===2?d("Unable to determine your location. Please check your device settings.","error"):s.code===3?d("Location request timed out. Please try again.","error"):d("Unable to detect your location. Please try again or enter manually.","error"),null}finally{j(!1)}},I=async s=>{try{const t=await z(s);t.error?d(t.message,"error"):(d(t.message,"success"),x())}catch{console.log("An error occurred")}},M=async s=>{try{const t=await R(s);t.error?d(t.message,"error"):(d(t.message,"success"),x())}catch{console.log("An error occurred")}};return e.jsxs(e.Fragment,{children:[e.jsxs("div",{className:"mt-4",children:[e.jsxs("div",{className:"mt-3",children:[e.jsx("h2",{className:"fs-6 fw-normal",children:"Saved Address"}),D?e.jsxs(e.Fragment,{children:[e.jsxs("div",{className:"border rounded px-3 py-3",children:[e.jsx(g,{style:{width:"70%"}}),e.jsx("p",{className:"mb-0 fw-medium",children:e.jsx(g,{})})]}),e.jsxs("div",{className:"border rounded px-3 py-3",children:[e.jsx(g,{style:{width:"70%"}}),e.jsx("p",{className:"mb-0 fw-medium",children:e.jsx(g,{})})]})]}):m?.length?m?.map(s=>e.jsx("div",{style:{cursor:"pointer"},className:s.isDefault?"border rounded px-3 py-3 mb-3 d_active":"border rounded px-3 py-3 mb-3",onClick:()=>{f(s),M(s._id)},children:e.jsxs("div",{className:"row align-items-center",children:[e.jsx("div",{className:"col-auto pe-0",children:e.jsx("input",{type:"radio",checked:s.isDefault,className:"custom-radio"},s._id)}),e.jsx("div",{className:"col",children:e.jsxs("div",{className:"row",children:[e.jsxs("div",{className:"col",children:[s.type,e.jsx("img",{src:"assets/image/icons/HouseLine.svg",alt:"",className:"ms-2"})]}),e.jsx("div",{className:"col-auto pe-0","data-bs-toggle":"modal","data-bs-target":"#addAddressModal",onClick:()=>w(s),children:e.jsx(y,{to:"",children:e.jsx("img",{src:"assets/image/icons/bxs_edit.svg",alt:""})})}),e.jsx("div",{className:"col-auto",onClick:()=>I(s._id),children:e.jsx(y,{children:e.jsx("img",{src:"assets/image/icons/Trash.svg",alt:""})})}),e.jsxs("p",{className:"mb-0 fw-medium",children:[s.address_line2," ",e.jsx("br",{}),s.address_line1]})]})})]})},s._id)):""]}),e.jsx("div",{className:"mt-4",children:e.jsxs("div",{className:"add-new-address","data-bs-toggle":"modal","data-bs-target":"#addAddressModal",children:[e.jsx("img",{src:"assets/image/icons/Plus-gray.svg",alt:""}),"Add New Address"]})})]}),e.jsx("div",{className:"modal fade",id:"addAddressModal",tabIndex:-1,"aria-hidden":"true","data-bs-backdrop":"static",children:e.jsx("div",{className:"modal-dialog modal-lg modal-dialog-centered",children:e.jsxs("div",{className:"modal-content",children:[e.jsxs("div",{className:"modal-header",children:[e.jsx("h5",{className:"modal-title fs-5 fw-semibold",children:"Enter Delivery Address"}),e.jsx("button",{type:"button",className:"btn-close","data-bs-dismiss":"modal",id:"closeAddressModal",onClick:()=>{w({}),A(),b({})}})]}),e.jsx("div",{className:"modal-body",children:e.jsxs("div",{className:"row",children:[e.jsxs("div",{className:"col-md-6",children:[e.jsxs("div",{className:"position-relative mb-3",children:[e.jsx("input",{type:"text",className:"form-control mb-2 ps-5",placeholder:"Search for arae, street name..."}),e.jsx("img",{src:"assets/image/icons/MagnifyingGlass.svg",className:"position-absolute top-50 translate-y-middle start-0 ms-1",alt:""})]}),e.jsx(y,{className:"dropdown-item current-loc p-2 mb-3",to:"",onClick:s=>{s.preventDefault(),T()},style:{border:"1px solid var(--border-light)"},children:e.jsxs("div",{className:"row align-items-center",children:[e.jsx("div",{className:"col-auto pe-0",children:_?e.jsx("i",{class:"fas fa-circle-notch fa-spin"}):e.jsx("i",{class:"fas fa-location"})}),e.jsx("div",{className:"col",children:"Using current location"})]})}),e.jsx("div",{children:e.jsx("div",{className:"border rounded overflow-hidden",children:e.jsx("iframe",{width:"100%",height:"200",style:{border:0},loading:"lazy",src:`https://maps.google.com/maps?q=${a?.coordinates?.lat||a?.latitude||i?.coordinates?.lat},${a?.coordinates?.lng||a?.longitude||i?.coordinates?.lng}&t=&z=15&ie=UTF8&iwloc=&output=embed`,title:"Location Map"})})})]}),e.jsx("div",{className:"col-md-6",children:e.jsxs("form",{onSubmit:k(O),children:[e.jsxs("div",{className:"mb-3",children:[e.jsx("label",{className:"form-label",children:"Delivery details"}),e.jsx("input",{type:"text",className:"form-control",readOnly:!0,value:a?.address_line1?a?.address_line1:a?.formattedShort?a?.formattedShort:i?.formattedShort})]}),e.jsxs("div",{className:"mb-3",children:[e.jsx("input",{type:"text",className:`form-control ${p.address_line2?"input-error":""}`,...S("address_line2",{required:"Address details is required"}),placeholder:"Address details*"}),p.address_line2&&e.jsx("p",{className:"form-error",children:p.address_line2.message}),e.jsx("span",{style:{color:"#6c757d",fontSize:"12px"},children:"E.g. Floor, House no."})]}),e.jsx("h6",{children:"Save Address As"}),e.jsxs("div",{className:"save-btns mb-3",children:[e.jsx("button",{type:"button",onClick:()=>h("Home"),className:u==="Home"?"btn btn-outline-secondary btn-sm btn-active":"btn btn-outline-secondary btn-sm",children:"Home"}),e.jsx("button",{type:"button",onClick:()=>h("Work"),className:u==="Work"?"btn btn-outline-secondary btn-sm btn-active":"btn btn-outline-secondary btn-sm",children:"Work"}),e.jsx("button",{type:"button",onClick:()=>h("Other"),className:u==="Other"?"btn btn-outline-secondary btn-sm btn-active":"btn btn-outline-secondary btn-sm",children:"Other"})]}),e.jsx("button",{type:"submit",className:"comman-btn-main w-100 mt-4 d-block",disabled:v,children:v?e.jsxs(e.Fragment,{children:[e.jsx("span",{className:"me-2",children:"Wait.."}),e.jsx($,{strokeColor:"white",strokeWidth:"5",animationDuration:"0.75",width:"20",visible:!0})]}):l?.address_line1?"Edit":"Save"})]})})]})})]})})})]})}const K=H.memo(Y);export{K as A};
