import{R as M,r as m,c as U,u as z,j as e,L as y,t as H,s as n,w as R,x as W,y as G,z as J}from"./index-CO4A6BKl.js";import{u as Y,a as Z}from"./footer-Dosfl34H.js";import{S as p}from"./skeleton-Bu_GamJ0.js";function B({setAddDetail:j}){const i=JSON.parse(sessionStorage.getItem("userLocation")),[L,N]=m.useState(!1),[h,g]=m.useState("Home"),[v,A]=m.useState(!1),[l,w]=m.useState({}),[t,b]=m.useState({}),{profile:S}=U(),{register:x,handleSubmit:k,reset:_,setValue:C,formState:{errors:c}}=Y({mode:"onChange"});m.useEffect(()=>{l?.address_line1?(C("address_line2",l?.address_line2),g(l?.type),b(l)):_()},[l]);const{data:D,isLoading:E,refetch:f}=z({queryKey:["addressList"],queryFn:async()=>J({page:1,pageSize:1e3})}),u=D?.results?.addresses;m.useEffect(()=>{if(u&&u?.length>0){const s=u.find(a=>a.isDefault===!0);s&&j(s)}},[u]);const F=async s=>{A(!0);const a={address_line1:i?.fullAddress,address_line2:s.address_line2,postal_code:i?.postcode,city:i?.city,country:i?.country,latitude:i?.coordinates?.lat,longitude:i?.coordinates?.lng,type:h},r={addressId:l?._id,address_line1:t?.address_line1?t?.address_line1:t?.fullAddress,address_line2:s.address_line2,postal_code:t?.postal_code?t?.postal_code:t?.postcode,city:t?.city,country:t?.country,latitude:t?.coordinates?t?.coordinates?.lat:t?.latitude,longitude:t?.coordinates?t?.coordinates?.lng:t?.longitude,type:h};try{const o=l?.address_line1?await W(r):await G(a);o.error?n(o.message,"error"):(n(o.message,"success"),await f(),document.getElementById("closeAddressModal").click())}catch{console.log("An error occurred")}finally{A(!1)}},O=()=>new Promise((s,a)=>{if(!navigator.geolocation){a(new Error("GEOLOCATION_NOT_SUPPORTED"));return}navigator.geolocation.getCurrentPosition(r=>s(r.coords),r=>a(r),{enableHighAccuracy:!0,timeout:15e3,maximumAge:0})}),P=async(s,a)=>{try{const r=await fetch(`https://nominatim.openstreetmap.org/reverse?format=json&lat=${s}&lon=${a}&addressdetails=1`,{headers:{"User-Agent":"YourAppName/1.0"}});if(!r.ok)throw new Error("Failed to fetch address");const o=await r.json(),d=o.address||{};return{fullAddress:o.display_name||"Address not found",locality:d.suburb||d.neighbourhood||d.village||"",city:d.city||d.town||d.state_district||"",state:d.state||"",country:d.country||"",postcode:d.postcode||"",formattedShort:q(d),coordinates:{lat:s,lng:a}}}catch(r){throw console.error("Address fetch error:",r),r}},q=s=>{const a=[];return(s.suburb||s.neighbourhood)&&a.push(s.suburb||s.neighbourhood),s.city||s.town?a.push(s.city||s.town):s.state_district&&a.push(s.state_district),a.join(", ")||"Current Location"},$=async()=>{N(!0);try{const s=await O(),{latitude:a,longitude:r}=s,o=await P(a,r);return l?.address_line1?b(o):sessionStorage.setItem("userLocation",JSON.stringify(o)),o}catch(s){return console.error("âŒ Location error:",s),s.message==="GEOLOCATION_NOT_SUPPORTED"?n("Your browser doesn't support location services","error"):s.code===1?n("Location access denied. Please enable location permission in your browser settings.","error"):s.code===2?n("Unable to determine your location. Please check your device settings.","error"):s.code===3?n("Location request timed out. Please try again.","error"):n("Unable to detect your location. Please try again or enter manually.","error"),null}finally{N(!1)}},T=async s=>{try{const a=await H(s);a.error?n(a.message,"error"):(n(a.message,"success"),f())}catch{console.log("An error occurred")}},I=async s=>{try{const a=await R(s);a.error?n(a.message,"error"):(n(a.message,"success"),f())}catch{console.log("An error occurred")}};return e.jsxs(e.Fragment,{children:[e.jsxs("div",{className:"mt-4",children:[e.jsxs("div",{className:"mt-3",children:[e.jsx("h2",{className:"fs-6 fw-normal",children:"Saved Address"}),E?e.jsxs(e.Fragment,{children:[e.jsxs("div",{className:"border rounded px-3 py-3",children:[e.jsx(p,{style:{width:"70%"}}),e.jsx("p",{className:"mb-0 fw-medium",children:e.jsx(p,{})})]}),e.jsxs("div",{className:"border rounded px-3 py-3",children:[e.jsx(p,{style:{width:"70%"}}),e.jsx("p",{className:"mb-0 fw-medium",children:e.jsx(p,{})})]})]}):u?.length?u?.map(s=>e.jsx("div",{style:{cursor:"pointer"},className:s.isDefault?"border rounded px-3 py-3 mb-3 d_active":"border rounded px-3 py-3 mb-3",onClick:()=>{j(s),I(s._id)},children:e.jsxs("div",{className:"row align-items-center",children:[e.jsx("div",{className:"col-auto pe-0",children:e.jsx("input",{type:"radio",checked:s.isDefault,className:"custom-radio"},s._id)}),e.jsx("div",{className:"col",children:e.jsxs("div",{className:"row",children:[e.jsxs("div",{className:"col",children:[s.type,e.jsx("img",{src:"assets/image/icons/HouseLine.svg",alt:"",className:"ms-2"})]}),e.jsx("div",{className:"col-auto pe-0","data-bs-toggle":"modal","data-bs-target":"#addAddressModal",onClick:()=>w(s),children:e.jsx(y,{to:"",children:e.jsx("img",{src:"assets/image/icons/bxs_edit.svg",alt:""})})}),e.jsx("div",{className:"col-auto",onClick:()=>T(s._id),children:e.jsx(y,{children:e.jsx("img",{src:"assets/image/icons/Trash.svg",alt:""})})}),e.jsxs("p",{className:"mb-0 fw-medium",children:[s.address_line2," ",e.jsx("br",{}),s.address_line1]})]})})]})},s._id)):""]}),e.jsx("div",{className:"mt-4",children:e.jsxs("div",{className:"add-new-address","data-bs-toggle":"modal","data-bs-target":"#addAddressModal",children:[e.jsx("img",{src:"assets/image/icons/Plus-gray.svg",alt:""}),"Add New Address"]})})]}),e.jsx("div",{className:"modal fade",id:"addAddressModal",tabIndex:-1,"aria-hidden":"true","data-bs-backdrop":"static",children:e.jsx("div",{className:"modal-dialog modal-lg modal-dialog-centered",children:e.jsxs("div",{className:"modal-content",children:[e.jsxs("div",{className:"modal-header",children:[e.jsx("h5",{className:"modal-title fs-5 fw-semibold",children:"Enter Delivery Address"}),e.jsx("button",{type:"button",className:"btn-close","data-bs-dismiss":"modal",id:"closeAddressModal",onClick:()=>{w({}),_(),b({})}})]}),e.jsx("div",{className:"modal-body",children:e.jsxs("div",{className:"row",children:[e.jsxs("div",{className:"col-md-6",children:[e.jsxs("div",{className:"position-relative mb-3",children:[e.jsx("input",{type:"text",className:"form-control mb-2 ps-5",placeholder:"Search for arae, street name..."}),e.jsx("img",{src:"assets/image/icons/MagnifyingGlass.svg",className:"position-absolute top-50 translate-y-middle start-0 ms-1",alt:""})]}),e.jsx(y,{className:"dropdown-item current-loc p-2 mb-3",to:"",onClick:s=>{s.preventDefault(),$()},style:{border:"1px solid var(--border-light)"},children:e.jsxs("div",{className:"row align-items-center",children:[e.jsx("div",{className:"col-auto pe-0",children:L?e.jsx("i",{class:"fas fa-circle-notch fa-spin"}):e.jsx("i",{class:"fas fa-location"})}),e.jsx("div",{className:"col",children:"Using current location"})]})}),e.jsx("div",{children:e.jsx("div",{className:"border rounded overflow-hidden",children:e.jsx("iframe",{width:"100%",height:"200",style:{border:0},loading:"lazy",src:`https://maps.google.com/maps?q=${t?.coordinates?.lat||t?.latitude||i?.coordinates?.lat},${t?.coordinates?.lng||t?.longitude||i?.coordinates?.lng}&t=&z=15&ie=UTF8&iwloc=&output=embed`,title:"Location Map"})})})]}),e.jsx("div",{className:"col-md-6",children:e.jsxs("form",{onSubmit:k(F),children:[S?.firstName?"":e.jsxs(e.Fragment,{children:[e.jsxs("div",{className:"mb-3",children:[e.jsx("label",{htmlFor:!0,className:"form-label",children:"First Name"}),e.jsx("input",{type:"text",className:`form-control ${c.firstName?"input-error":""}`,placeholder:"Enter first name",...x("firstName",{required:"First name is required",minLength:{value:2,message:"First name must be at least 2 characters"},maxLength:{value:50,message:"First name must be less than 50 characters"},pattern:{value:/^[A-Za-z\s]+$/,message:"First name can only contain letters and spaces"}})}),c.firstName&&e.jsx("p",{className:"form-error",children:c.firstName.message})]}),e.jsxs("div",{className:"mb-3",children:[e.jsx("label",{htmlFor:!0,className:"form-label",children:"Last Name"}),e.jsx("input",{type:"text",className:`form-control ${c.lastName?"input-error":""}`,placeholder:"Enter last name",...x("lastName",{required:"Last name is required",minLength:{value:2,message:"Last name must be at least 2 characters"},maxLength:{value:50,message:"Last name must be less than 50 characters"},pattern:{value:/^[A-Za-z\s]+$/,message:"Last name can only contain letters and spaces"}})}),c.lastName&&e.jsx("p",{className:"form-error",children:c.lastName.message})]})]}),e.jsxs("div",{className:"mb-3",children:[e.jsx("label",{className:"form-label",children:"Delivery details"}),e.jsx("input",{type:"text",className:"form-control",readOnly:!0,value:t?.address_line1?t?.address_line1:t?.formattedShort?t?.formattedShort:i?.formattedShort})]}),e.jsxs("div",{className:"mb-3",children:[e.jsx("input",{type:"text",className:`form-control ${c.address_line2?"input-error":""}`,...x("address_line2",{required:"Address details is required"}),placeholder:"Address details*"}),c.address_line2&&e.jsx("p",{className:"form-error",children:c.address_line2.message}),e.jsx("span",{style:{color:"#6c757d",fontSize:"12px"},children:"E.g. Floor, House no."})]}),e.jsx("h6",{children:"Save Address As"}),e.jsxs("div",{className:"save-btns mb-3",children:[e.jsx("button",{type:"button",onClick:()=>g("Home"),className:h==="Home"?"btn btn-outline-secondary btn-sm btn-active":"btn btn-outline-secondary btn-sm",children:"Home"}),e.jsx("button",{type:"button",onClick:()=>g("Work"),className:h==="Work"?"btn btn-outline-secondary btn-sm btn-active":"btn btn-outline-secondary btn-sm",children:"Work"}),e.jsx("button",{type:"button",onClick:()=>g("Other"),className:h==="Other"?"btn btn-outline-secondary btn-sm btn-active":"btn btn-outline-secondary btn-sm",children:"Other"})]}),e.jsx("button",{type:"submit",className:"comman-btn-main w-100 mt-4 d-block",disabled:v,children:v?e.jsxs(e.Fragment,{children:[e.jsx("span",{className:"me-2",children:"Wait.."}),e.jsx(Z,{strokeColor:"white",strokeWidth:"5",animationDuration:"0.75",width:"20",visible:!0})]}):l?.address_line1?"Edit":"Save"})]})})]})})]})})})]})}const X=M.memo(B);export{X as A};
