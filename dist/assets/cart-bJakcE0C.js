import{R as C,r as u,l as q,c as D,u as k,j as s,L as N,h as S,s as d,m as F,n as L,o as O}from"./index-C6SVcNZ3.js";import{H as E,a as Y,F as Q}from"./footer-CUq9XlbX.js";import{S as r}from"./skeleton-_znFtJzo.js";import{A as H}from"./addressCart-BteinNQ4.js";function R(){const[n,y]=u.useState({}),[m,b]=u.useState(0),[j,p]=u.useState(!1),w=q(),{refetch:x}=D(),{data:i,isLoading:l,refetch:f}=k({queryKey:["cartList"],queryFn:O,select:e=>e.results.carts[0]}),I=async(e,c)=>{const t={productId:e,variantId:c};console.log(t);try{const a=await F(t);a.error?d(a.message,"error"):(d(a.message,"success"),f(),x())}catch{console.log("An error occurred")}},v=async(e,c)=>{const t=e.quantity+c;if(t<1)return;const a={productId:e.productId._id,variantId:e.variantId._id,quantity:t};try{const o=await S(a);o.error?d(o.message,"error"):(d(o.message,"success"),f(),x())}catch{console.log("An error occurred")}},A=e=>{b(Number(e.target.value))},_=i?.products?.reduce((e,c)=>e+c.variantId.price*c.quantity,0),h=i?.products?.reduce((e,c)=>e+(c.variantId.discountPrice||c.variantId.price)*c.quantity,0),g=i?.products?.reduce((e,c)=>{const t=c.variantId.price*c.quantity,a=(c.variantId.discountPrice||c.variantId.price)*c.quantity;return e+(t-a)},0),P=async()=>{if(!n?.address_line1){d("Please select address","error");return}p(!0);const e={address_line1:n?.address_line1,address_line2:n?.address_line2,postal_code:n?.postal_code,city:n?.city,country:n?.country,latitude:n?.latitude,longitude:n?.longitude,type:n?.type},t={products:i?.products?.map(a=>({cartId:a?._id,productId:a.productId._id,variantId:a.variantId._id,merchantId:a.productId.userId._id,quantity:a.quantity,amount:a.variantId.price,paidAmount:0,discount:a.variantId.discountPrice,advancePayment:0})),address:e,amount:h,paidAmount:m,discount:g};try{const a=await L(t);a.error?d(a.message,"error"):(d(a.message,"success"),x(),w(`/order-confirmed/${a.results.order._id}`))}catch{console.log("An error occurred")}finally{p(!1)}};return s.jsxs(s.Fragment,{children:[s.jsx(E,{}),s.jsx("section",{className:"checkout",children:s.jsxs("div",{className:"container comman-spacing-top-bottom",children:[s.jsx("h2",{className:"heading",children:"Checkout"}),s.jsx("div",{className:"comman-spacing-top-bottom",children:i?.products?.length||l?s.jsxs("div",{className:"row",children:[s.jsxs("div",{className:"col-md-7 col-lg-8",children:[s.jsxs("div",{className:"rounded-3 bg-white overflow-hidden px-2 py-2",children:[l?[...Array(5)].map((e,c)=>s.jsxs("div",{className:"cart-item d-flex align-items-center justify-content-between",children:[s.jsxs("div",{className:"col-12 col-md-7 col-lg-6 d-flex align-items-center gap-2",children:[s.jsx("div",{className:"cart-img",children:s.jsx(r,{})}),s.jsxs("div",{className:"w-100",children:[s.jsx("h6",{className:"product-heading",children:s.jsx(r,{style:{width:"100%"}})}),s.jsx("small",{className:"text-muted",children:s.jsx(r,{style:{width:"100%"}})}),s.jsxs("p",{className:"fw-bold mb-0 mt-2",children:[" ",s.jsx(r,{style:{width:"100%"}})]})]})]}),s.jsx("div",{className:"col-12 col-md-5 col-lg-6 d-flex align-items-center justify-content-end gap-2",children:s.jsxs("div",{className:"w-100 text-end",children:[" ",s.jsx(r,{height:40,style:{width:"30%"}})]})})]},c)):i?.products?.map(e=>s.jsxs("div",{className:"cart-item d-flex align-items-center justify-content-between mb-3",children:[s.jsxs("div",{className:"col-12 col-md-7 col-lg-6 d-flex align-items-center gap-2",children:[s.jsx(N,{className:"cart-img",to:`/product-details/${e?.productId?._id}`,children:s.jsx("img",{src:e?.productId?.images?.[0],className:"rounded",alt:e?.productId?.images?.[0]})}),s.jsxs("div",{children:[s.jsx("h6",{className:"product-heading",children:e.productId.name_en}),s.jsx("small",{className:"text-muted",children:e.productId.userId.shopName}),s.jsxs("p",{className:"fw-bold mb-0 mt-2",children:["₹",e?.variantId?.price]})]})]}),s.jsxs("div",{className:"col-12 col-md-5 col-lg-6 d-flex align-items-center justify-content-end gap-2",children:[s.jsxs("div",{className:"add-btn add-btn2",children:[s.jsx("button",{onClick:()=>v(e,-1),disabled:e?.quantity<=1,children:s.jsx("i",{className:"fa fa-minus"})}),s.jsx("button",{children:e?.quantity}),s.jsx("button",{onClick:()=>v(e,1),children:s.jsx("i",{className:"fa fa-plus"})})]}),s.jsx("div",{onClick:()=>I(e.productId._id,e.variantId._id),style:{cursor:"pointer"},children:s.jsx("img",{src:"assets/image/icons/Trash.svg",alt:""})})]})]},e?.productId?._id)),l?"":s.jsxs("div",{className:"mt-4",children:[s.jsx("div",{className:"border-top pt-3"}),s.jsxs("div",{className:"bill-details mt-3",children:[s.jsx("h2",{className:"heading",children:"Bill details"}),s.jsxs("p",{className:"d-flex justify-content-between mb-1",children:[s.jsx("span",{children:"Subtotal"}),s.jsxs("span",{children:[s.jsxs("del",{className:"text-muted",children:["₹",_||0]}),s.jsxs("strong",{className:"ms-2",children:["₹",h||0]})]})]}),s.jsxs("p",{className:"d-flex justify-content-between mb-3 text-success",children:[s.jsx("span",{children:"Discount"}),s.jsxs("span",{children:["-₹",g||0]})]}),s.jsxs("p",{className:"d-flex justify-content-between mb-3",children:[s.jsx("span",{children:"Delivery Charges"})," ",s.jsx("span",{children:"₹30"})]}),s.jsxs("p",{className:"d-flex justify-content-between mb-1",children:[s.jsx("span",{children:"Platform Fees"})," ",s.jsx("span",{children:"₹5"})]}),s.jsxs("h6",{className:"d-flex justify-content-between fw-bold",children:[s.jsx("span",{children:"Total Payable"}),s.jsxs("span",{children:["₹",h+35]})]})]})]})]}),l?"":s.jsx("div",{className:"mt-3",children:s.jsxs("div",{className:"rounded-3 bg-white overflow-hidden px-3 py-3",children:[s.jsx("h2",{className:"heading",children:"Delivery Address"}),s.jsx(H,{setAddDetail:y,addDetail:n})]})})]}),l?s.jsx("div",{className:"col-md-5 col-lg-4",children:s.jsxs("div",{className:"rounded-3 bg-white overflow-hidden px-3 py-4",children:[s.jsx("h2",{children:s.jsx(r,{})}),s.jsx("h2",{className:"mt-3",children:s.jsx(r,{})}),s.jsx("h2",{className:"mt-3",children:s.jsx(r,{})}),s.jsx("h2",{className:"mt-3",children:s.jsx(r,{})})]})}):s.jsx("div",{className:"col-md-5 col-lg-4",children:s.jsxs("div",{className:"rounded-3 bg-white overflow-hidden px-3 py-4",children:[s.jsx("h2",{children:"Payment Option"}),s.jsx("div",{className:"payment-option mt-4",children:s.jsxs("label",{className:"d-flex gap-3 align-items-center",style:{cursor:"pointer"},children:[s.jsx("input",{type:"radio",name:"payment-method",value:0,checked:m===0,onChange:A,className:"custom-radio"}),s.jsx("div",{children:"Cash on Delivery"})]})}),s.jsx("div",{className:"mt-3",children:s.jsx("button",{className:"comman-btn-main w-100",disabled:j,onClick:()=>P(),children:j?s.jsxs(s.Fragment,{children:[s.jsx(Y,{strokeColor:"white",strokeWidth:"5",animationDuration:"0.75",width:"20",visible:!0}),s.jsx("span",{className:"ms-2",children:" Wait.."})]}):m===0?"Place Order":"Pay Now"})})]})})]}):s.jsxs("div",{className:"mt-3 no-data mx-auto d-flex flex-column justify-content-center align-items-center",children:[s.jsx("img",{src:"../assets/image/products/noData.avif",alt:"nodata",loading:"lazy"}),s.jsx("h1",{children:"Your cart is empty"}),s.jsx("p",{children:"You can go to home page to view more products"}),s.jsx(N,{className:"comman-btn-main",to:"/",children:"Home"})]})})]})}),s.jsx(Q,{}),s.jsxs("div",{class:"offcanvas offcanvas-end",tabindex:"-1",id:"couponOffcanvas","aria-labelledby":"couponOffcanvasLabel",children:[s.jsxs("div",{className:"offcanvas-header",children:[s.jsx("h5",{id:"couponOffcanvasLabel",children:"All Coupons"}),s.jsx("button",{type:"button",className:"btn-close","data-bs-dismiss":"offcanvas","aria-label":"Close"})]}),s.jsx("div",{className:"offcanvas-body",children:s.jsx("div",{className:"coupon-list",children:s.jsxs("div",{className:"coupon-item",children:[s.jsx("div",{className:"coupon-card p-0 bg-transparent",children:s.jsxs("div",{className:"row g-3",children:[s.jsx("di",{className:"col-8",children:s.jsxs("div",{className:"coupon-input",children:[s.jsx("input",{type:"text",className:"form-control"}),s.jsx("img",{src:"assets/image/icons/percentage.svg",className:"icon",alt:""})]})}),s.jsx("di",{className:"col-4",children:s.jsx("button",{className:"comman-btn-main",children:"Apply"})})]})}),s.jsxs("div",{className:"mt-4",children:[s.jsx("h2",{className:"heading",children:"Available offers"}),s.jsxs("div",{className:"mt-4",children:[s.jsxs("div",{className:"coupon-card-items",children:[s.jsxs("div",{className:"d-flex justify-content-between align-items-center",children:[s.jsxs("div",{className:"d-flex gap-2 align-items-center",children:[s.jsx("img",{src:"assets/image/icons/percentage.svg",alt:""}),s.jsx("div",{className:"offer",children:"SAVE20"})]}),s.jsx("p",{className:"apply",children:"Apply"})]}),s.jsxs("div",{className:"mt-3",children:[s.jsx("p",{className:"save",children:"You save ₹50"}),s.jsx("p",{className:"percentage-offer-dis",children:"5% off entire order on minimum of ₹200"})]})]}),s.jsxs("div",{className:"coupon-card-items",children:[s.jsxs("div",{className:"d-flex justify-content-between align-items-center",children:[s.jsxs("div",{className:"d-flex gap-2 align-items-center",children:[s.jsx("img",{src:"assets/image/icons/percentage.svg",alt:""}),s.jsx("div",{className:"offer",children:"SAVE20"})]}),s.jsx("p",{className:"apply",children:"Apply"})]}),s.jsxs("div",{className:"mt-3",children:[s.jsx("p",{className:"save",children:"You save ₹50"}),s.jsx("p",{className:"percentage-offer-dis",children:"5% off entire order on minimum of ₹200"})]})]}),s.jsxs("div",{className:"coupon-card-items",children:[s.jsxs("div",{className:"d-flex justify-content-between align-items-center",children:[s.jsxs("div",{className:"d-flex gap-2 align-items-center",children:[s.jsx("img",{src:"assets/image/icons/percentage.svg",alt:""}),s.jsx("div",{className:"offer",children:"SAVE20"})]}),s.jsx("p",{className:"apply",children:"Apply"})]}),s.jsxs("div",{className:"mt-3",children:[s.jsx("p",{className:"save",children:"You save ₹50"}),s.jsx("p",{className:"percentage-offer-dis",children:"5% off entire order on minimum of ₹200"})]})]})]})]})]})})})]})]})}const z=C.memo(R);export{z as default};
